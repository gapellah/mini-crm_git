# AGENTS.md — Mini CRM Scaffold (Flask)

## Goal
Flask製の「物件・契約管理ミニCRM」の最小動作品を構築し、起動可能にする。

## Acceptance Criteria
- ログイン/登録（Flask-Login + Flask-WTF）
- CRUD: 物件 / 入居者 / 契約（一覧＋新規作成）
- DB: SQLAlchemy + Flask-Migrate（初期マイグレーションが通る）
- ルート: `/` `/auth/login` `/auth/register` `/properties` `/tenants` `/leases`
- `pytest` のスモークテストが通る
- `flask --app wsgi run --debug` で起動

## Repository Layout (to create)
mini-crm/
- app/
  - __init__.py
  - extensions.py
  - models.py
  - blueprints/
    - auth/ (__init__.py, routes.py, forms.py)
    - core/ (__init__.py, routes.py, forms.py)
  - templates/
    - base.html, index.html
    - auth/ (login.html, register.html)
    - core/ (properties_list.html, property_form.html, tenants_list.html, tenant_form.html, leases_list.html, lease_form.html)
  - static/
- migrations/        (generated by Flask-Migrate)
- tests/             (pytest)
  - test_smoke.py
- config.py
- wsgi.py
- requirements.txt, .env.example, .gitignore  (already exist)

## Models (minimum)
- User(id, email unique, password_hash, role)
- Property(id, name, address, note)
- Tenant(id, name, email, phone)
- Lease(id, property_id FK, tenant_id FK, rent, start_date, end_date, status)

## Forms
- LoginForm, RegisterForm
- PropertyForm(name, address, note)
- TenantForm(name, email, phone)
- LeaseForm(property_id Select, tenant_id Select, rent, start_date, end_date)

## Commands (run in this order)
python -m pip install -U pip
pip install -r requirements.txt
set -x FLASK_APP wsgi   # Windows は: set FLASK_APP=wsgi
flask db init || true
flask db migrate -m "init"
flask db upgrade
pytest -q
# run manually:
# flask --app wsgi run --debug

## Coding Rules
- Black / Ruff で整形（可能なら自動修正）
- `.env` から SECRET_KEY / DATABASE_URL を読む（python-dotenv）
- 例外時は修正して再実行し、テストをグリーンにする