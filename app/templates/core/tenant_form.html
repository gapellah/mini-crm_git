<div class="box">
  <h2 class="subtitle">{{ '入居者を編集' if editing_tenant else '入居者を追加' }}</h2>
  {% if editing_tenant %}
    <div class="notification is-warning is-light">
      編集モード: {{ editing_tenant.property.name if editing_tenant.property else '-' }} / {{ editing_tenant.unit_number or '-' }} / {{ editing_tenant.name }}
      <a class="button is-small is-light" href="{{ url_for('core.tenants', property_id=selected_property_id) }}">編集をやめる</a>
    </div>
  {% endif %}
  <form method="post">
    {{ form.hidden_tag() }}
    {{ form.tenant_id() }}
    <div class="field">
      <label class="label">{{ form.property_id.label }}</label>
      <div class="control">
        <div class="select is-fullwidth">
          {{ form.property_id() }}
        </div>
      </div>
      {% for error in form.property_id.errors %}
        <p class="help is-danger">{{ error }}</p>
      {% endfor %}
    </div>
    <div class="field">
      <label class="label">{{ form.unit_number.label }}</label>
      <div class="control">
        {{ form.unit_number(class="input") }}
      </div>
      {% for error in form.unit_number.errors %}
        <p class="help is-danger">{{ error }}</p>
      {% endfor %}
    </div>
    <div class="field">
      <label class="label">{{ form.name.label }}</label>
      <div class="control">
        {{ form.name(class="input") }}
      </div>
      {% for error in form.name.errors %}
        <p class="help is-danger">{{ error }}</p>
      {% endfor %}
    </div>
    <div class="field">
      <label class="label">{{ form.email.label }}</label>
      <div class="control">
        {{ form.email(class="input") }}
      </div>
      {% for error in form.email.errors %}
        <p class="help is-danger">{{ error }}</p>
      {% endfor %}
    </div>
    <div class="field">
      <label class="label">{{ form.phone.label }}</label>
      <div class="control">
        {{ form.phone(class="input") }}
      </div>
      {% for error in form.phone.errors %}
        <p class="help is-danger">{{ error }}</p>
      {% endfor %}
    </div>
    <div class="field">
      <div class="control">
        {{ form.submit(class="button is-primary") }}
      </div>
    </div>
  </form>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const select = document.getElementById("{{ form.property_id.id }}");
    const tenantIdField = document.getElementById("{{ form.tenant_id.id }}");
    if (!select) {
      return;
    }
    select.addEventListener("change", function () {
      const params = new URLSearchParams(window.location.search);
      params.set("property_id", select.value);
      if (tenantIdField && tenantIdField.value) {
        params.set("tenant_id", tenantIdField.value);
      }
      const query = params.toString();
      const base = "{{ url_for('core.tenants') }}";
      window.location = query ? `${base}?${query}` : base;
    });
  });
</script>
